{% extends "base.html" %}
{% block title %}Dashboard | KBG Europe{% endblock %}

{% block content %}
<section class="section section-light">
    <div class="container">

        <h1 class="section-title">Dashboard</h1>
        <p>Willkommen im internen Bereich.</p>

        <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
            <a class="btn btn-primary" href="{% url 'logout' %}">Abmelden</a>
            <a class="btn" href="{% url 'home' %}">Zurück zur Startseite</a>
        </div>

        <!-- Tabs + Inhalt -->
        <div class="dashboard-layout" style="margin-top: 2rem;">

            <!-- Horizontale Tabs -->
            <nav class="dashboard-tabs" aria-label="Dashboard-Bereiche">
                <button type="button" class="dashboard-tab-btn" data-tab-target="statistiken">
                    Statistiken
                </button>
                <button type="button" class="dashboard-tab-btn" data-tab-target="anfragen">
                    Anfragen
                </button>
                <button type="button" class="dashboard-tab-btn" data-tab-target="medien">
                    Medien
                </button>
                <button type="button" class="dashboard-tab-btn" data-tab-target="seo">
                    SEO
                </button>
                {% if user.is_superuser %}
                <button type="button" class="dashboard-tab-btn" data-tab-target="benutzer">
                    Benutzer-Management
                </button>
                {% endif %}
            </nav>

            <!-- Panels -->
            <div class="dashboard-panels">

                <!-- Statistiken -->
                <div class="dashboard-panel" data-tab-panel="statistiken">
                    <h2>Statistiken</h2>
                    <p>Übersicht über Traffic und Performance. Hier kannst du z.&nbsp;B. Google Analytics oder ähnliche Tools einbinden.</p>

                    <div class="card" style="padding: 1rem; border-radius: 6px; background: #ffffff; box-shadow: 0 1px 3px rgba(0,0,0,0.08);">
                        <p style="margin-bottom: .5rem;"><strong>Google Traffic Embed</strong></p>
                        <p style="font-size: .9rem; color: #555;">
                            Hier könnte ein iframe o. Ä. eingefügt werden, z.&nbsp;B.:
                        </p>
                        <pre style="font-size: .8rem; white-space: pre-wrap; background:#f7f7f7; padding:.75rem; border-radius:4px;">
&lt;iframe src="DEIN_GOOGLE_EMBED_URL" width="100%" height="400" frameborder="0"&gt;&lt;/iframe&gt;
                        </pre>
                    </div>
                </div>

                <!-- Anfragen -->
                <div class="dashboard-panel" data-tab-panel="anfragen">
                    <h2>Anfragen</h2>
                    <p>Verwalte Catering- und Kontaktanfragen und beantworte sie direkt aus dem Dashboard.</p>

                    <h3 style="margin-top: 1.5rem;">Catering-Anfragen</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Datum</th>
                                <th>Name</th>
                                <th>E-Mail</th>
                                <th>Status</th>
                                <th>Aktion</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for req in catering_requests %}
                            <tr>
                                <td>{{ req.created_at|date:"d.m.Y H:i" }}</td>
                                <td>{{ req.contact_person }}</td>
                                <td>{{ req.email }}</td>
                                <td>
                                    {% if req.status == "open" %}
                                        Offen
                                    {% else %}
                                        Beantwortet
                                    {% endif %}
                                </td>
                                <td>
                                    <button type="button"
                                            class="btn btn-primary btn-sm"
                                            data-toggle-reply="catering-{{ req.id }}">
                                        Antworten
                                    </button>
                                </td>
                            </tr>
                            <tr id="reply-row-catering-{{ req.id }}" class="request-reply-row" style="display:none;">
                                <td colspan="5">
                                    <form method="post" action="{% url 'answer_catering_request' req.id %}">
                                        {% csrf_token %}
                                        <label>Antwort an {{ req.email }}:</label>
                                        <textarea name="reply_text" rows="3" class="form-control">{% if req.reply_text %}{{ req.reply_text }}{% endif %}</textarea>
                                        <div style="margin-top:.5rem;">
                                            <button type="submit" class="btn btn-primary btn-sm">E-Mail senden</button>
                                        </div>
                                    </form>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="5">Noch keine Catering-Anfragen.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                    <h3 style="margin-top: 1.5rem;">Kontakt-Anfragen</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Datum</th>
                                <th>Name</th>
                                <th>E-Mail</th>
                                <th>Betreff</th>
                                <th>Status</th>
                                <th>Aktion</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for req in contact_requests %}
                            <tr>
                                <td>{{ req.created_at|date:"d.m.Y H:i" }}</td>
                                <td>{{ req.name }}</td>
                                <td>{{ req.email }}</td>
                                <td>{{ req.message|truncatechars:40 }}</td>
                                <td>
                                    {% if req.status == "open" %}
                                        Offen
                                    {% else %}
                                        Beantwortet
                                    {% endif %}
                                </td>
                                <td>
                                    <button type="button"
                                            class="btn btn-primary btn-sm"
                                            data-toggle-reply="contact-{{ req.id }}">
                                        Antworten
                                    </button>
                                </td>
                            </tr>
                            <tr id="reply-row-contact-{{ req.id }}" class="request-reply-row" style="display:none;">
                                <td colspan="6">
                                    <form method="post" action="{% url 'answer_contact_request' req.id %}">
                                        {% csrf_token %}
                                        <label>Antwort an {{ req.email }}:</label>
                                        <textarea name="reply_text" rows="3" class="form-control">{% if req.reply_text %}{{ req.reply_text }}{% endif %}</textarea>
                                        <div style="margin-top:.5rem;">
                                            <button type="submit" class="btn btn-primary btn-sm">E-Mail senden</button>
                                        </div>
                                    </form>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6">Noch keine Kontakt-Anfragen.</td>
                            </tr>
                            {% endfor %}
                        </tbody>

                    </table>
                </div>

                <!-- Medien -->
                <div class="dashboard-panel" data-tab-panel="medien">
                    <h2>Medien</h2>
                    <p>Verwalte Bilder für die Website, z.&nbsp;B. Logo, Startseite, Menü oder Kontaktseite.</p>

                    <!-- Unter-Tabs für Seiten -->
                    <nav class="media-subtabs">
                        <button type="button" class="media-subtab-btn" data-media-target="media-home">Home</button>
                        <button type="button" class="media-subtab-btn" data-media-target="media-menu">Menü</button>
                        <button type="button" class="media-subtab-btn" data-media-target="media-catering">Catering</button>
                        <button type="button" class="media-subtab-btn" data-media-target="media-kontakt">Kontakt</button>
                        <button type="button" class="media-subtab-btn" data-media-target="media-layout">Layout / Logo</button>
                    </nav>

                    <div class="media-panels">

                        {# ---------- HOME ---------- #}
                        <div class="media-panel" data-media-panel="media-home">
                            <h3>Startseite</h3>

                            {# Helper-Block für Dictionary-Lookup #}
                            {% with img=site_images.home_hero %}
                            <div class="media-slot">
                                <div class="media-slot-info">
                                    <h4>Home – Hero-Bild</h4>
                                    <p>Großes Bild ganz oben auf der Startseite.</p>
                                    <p>
                                        Aktuell:
                                        {% if img and img.image %}
                                            <a href="{{ img.image.url }}" target="_blank">Bild ansehen</a>
                                        {% else %}
                                            <em>Standard-Platzhalter wird verwendet.</em>
                                        {% endif %}
                                    </p>
                                </div>
                                <div class="media-slot-form">
                                    <form method="post" enctype="multipart/form-data" action="{% url 'dashboard_media_update' %}">
                                        {% csrf_token %}
                                        <input type="hidden" name="media_key" value="home_hero">
                                        <input type="file" name="image" required>
                                        <input type="text" name="alt_text"
                                               placeholder="Alt-Text"
                                               value="{% if img %}{{ img.alt_text }}{% endif %}">
                                        <button type="submit" class="btn btn-primary btn-sm">Speichern</button>
                                    </form>
                                </div>
                            </div>
                            {% endwith %}

                            {% with img=site_images.home_about_image %}
                            <div class="media-slot">
                                <div class="media-slot-info">
                                    <h4>Home – „Wer wir sind“-Bild</h4>
                                    <p>Bild rechts neben dem Textblock „Wer wir sind“.</p>
                                    <p>
                                        Aktuell:
                                        {% if img and img.image %}
                                            <a href="{{ img.image.url }}" target="_blank">Bild ansehen</a>
                                        {% else %}
                                            <em>Standard-Platzhalter.</em>
                                        {% endif %}
                                    </p>
                                </div>
                                <div class="media-slot-form">
                                    <form method="post" enctype="multipart/form-data" action="{% url 'dashboard_media_update' %}">
                                        {% csrf_token %}
                                        <input type="hidden" name="media_key" value="home_about_image">
                                        <input type="file" name="image" required>
                                        <input type="text" name="alt_text"
                                               placeholder="Alt-Text"
                                               value="{% if img %}{{ img.alt_text }}{% endif %}">
                                        <button type="submit" class="btn btn-primary btn-sm">Speichern</button>
                                    </form>
                                </div>
                            </div>
                            {% endwith %}

                            {% with img=site_images.home_menu_1 %}
                            <div class="media-slot">
                                <div class="media-slot-info">
                                    <h4>Home – Menü-Galerie Bild 1</h4>
                                    <p>Erstes Bild in der dreispaltigen Menü-Galerie.</p>
                                    <p>
                                        Aktuell:
                                        {% if img and img.image %}<a href="{{ img.image.url }}" target="_blank">Bild ansehen</a>
                                        {% else %}<em>Standard-Platzhalter.</em>{% endif %}
                                    </p>
                                </div>
                                <div class="media-slot-form">
                                    <form method="post" enctype="multipart/form-data" action="{% url 'dashboard_media_update' %}">
                                        {% csrf_token %}
                                        <input type="hidden" name="media_key" value="home_menu_1">
                                        <input type="file" name="image" required>
                                        <input type="text" name="alt_text"
                                               placeholder="Alt-Text"
                                               value="{% if img %}{{ img.alt_text }}{% endif %}">
                                        <button type="submit" class="btn btn-primary btn-sm">Speichern</button>
                                    </form>
                                </div>
                            </div>
                            {% endwith %}

                            {% with img=site_images.home_menu_2 %}
                            <div class="media-slot">
                                <div class="media-slot-info">
                                    <h4>Home – Menü-Galerie Bild 2</h4>
                                    <p>Zweites Bild in der dreispaltigen Menü-Galerie.</p>
                                    <p>
                                        Aktuell:
                                        {% if img and img.image %}<a href="{{ img.image.url }}" target="_blank">Bild ansehen</a>
                                        {% else %}<em>Standard-Platzhalter.</em>{% endif %}
                                    </p>
                                </div>
                                <div class="media-slot-form">
                                    <form method="post" enctype="multipart/form-data" action="{% url 'dashboard_media_update' %}">
                                        {% csrf_token %}
                                        <input type="hidden" name="media_key" value="home_menu_2">
                                        <input type="file" name="image" required>
                                        <input type="text" name="alt_text"
                                               placeholder="Alt-Text"
                                               value="{% if img %}{{ img.alt_text }}{% endif %}">
                                        <button type="submit" class="btn btn-primary btn-sm">Speichern</button>
                                    </form>
                                </div>
                            </div>
                            {% endwith %}

                            {% with img=site_images.home_menu_3 %}
                            <div class="media-slot">
                                <div class="media-slot-info">
                                    <h4>Home – Menü-Galerie Bild 3</h4>
                                    <p>Drittes Bild in der dreispaltigen Menü-Galerie.</p>
                                    <p>
                                        Aktuell:
                                        {% if img and img.image %}<a href="{{ img.image.url }}" target="_blank">Bild ansehen</a>
                                        {% else %}<em>Standard-Platzhalter.</em>{% endif %}
                                    </p>
                                </div>
                                <div class="media-slot-form">
                                    <form method="post" enctype="multipart/form-data" action="{% url 'dashboard_media_update' %}">
                                        {% csrf_token %}
                                        <input type="hidden" name="media_key" value="home_menu_3">
                                        <input type="file" name="image" required>
                                        <input type="text" name="alt_text"
                                               placeholder="Alt-Text"
                                               value="{% if img %}{{ img.alt_text }}{% endif %}">
                                        <button type="submit" class="btn btn-primary btn-sm">Speichern</button>
                                    </form>
                                </div>
                            </div>
                            {% endwith %}

                            {# ... analog: home_catering_1..4, home_testimonials_bg #}
                        </div>

                        {# ---------- MENÜ ---------- #}
                        <div class="media-panel" data-media-panel="media-menu">
                            <h3>Menü-Seite</h3>

                            {% with img=site_images.menu_hero %}
                            <div class="media-slot">
                                <div class="media-slot-info">
                                    <h4>Menü – Hero-Bild</h4>
                                    <p>Großes Bild oben (Ramyun-Hintergrund).</p>
                                    <p>
                                        Aktuell:
                                        {% if img and img.image %}<a href="{{ img.image.url }}" target="_blank">Bild ansehen</a>
                                        {% else %}<em>Standard-Platzhalter.</em>{% endif %}
                                    </p>
                                </div>
                                <div class="media-slot-form">
                                    <form method="post" enctype="multipart/form-data" action="{% url 'dashboard_media_update' %}">
                                        {% csrf_token %}
                                        <input type="hidden" name="media_key" value="menu_hero">
                                        <input type="file" name="image" required>
                                        <input type="text" name="alt_text"
                                               placeholder="Alt-Text"
                                               value="{% if img %}{{ img.alt_text }}{% endif %}">
                                        <button type="submit" class="btn btn-primary btn-sm">Speichern</button>
                                    </form>
                                </div>
                            </div>
                            {% endwith %}

                            {# hier kannst du analogue Blöcke für menu_1_bibimbap, menu_2_bbq_bowl, ... anlegen #}
                        </div>

                        {# ---------- CATERING ---------- #}
                        <div class="media-panel" data-media-panel="media-catering">
                            <h3>Catering-Seite</h3>

                            {% with img=site_images.catering_hero %}
                            <div class="media-slot">
                                <div class="media-slot-info">
                                    <h4>Catering – Hero-Bild</h4>
                                    <p>Großes Bild oben auf der Catering-Seite.</p>
                                    <p>
                                        Aktuell:
                                        {% if img and img.image %}<a href="{{ img.image.url }}" target="_blank">Bild ansehen</a>
                                        {% else %}<em>Standard-Platzhalter.</em>{% endif %}
                                    </p>
                                </div>
                                <div class="media-slot-form">
                                    <form method="post" enctype="multipart/form-data" action="{% url 'dashboard_media_update' %}">
                                        {% csrf_token %}
                                        <input type="hidden" name="media_key" value="catering_hero">
                                        <input type="file" name="image" required>
                                        <input type="text" name="alt_text"
                                               placeholder="Alt-Text"
                                               value="{% if img %}{{ img.alt_text }}{% endif %}">
                                        <button type="submit" class="btn btn-primary btn-sm">Speichern</button>
                                    </form>
                                </div>
                            </div>
                            {% endwith %}

                            {% with img=site_images.catering_bottom %}
                            <div class="media-slot">
                                <div class="media-slot-info">
                                    <h4>Catering – Unteres Dekobild</h4>
                                    <p>Bild ganz unten auf der Catering-Seite.</p>
                                    <p>
                                        Aktuell:
                                        {% if img and img.image %}<a href="{{ img.image.url }}" target="_blank">Bild ansehen</a>
                                        {% else %}<em>Standard-Platzhalter.</em>{% endif %}
                                    </p>
                                </div>
                                <div class="media-slot-form">
                                    <form method="post" enctype="multipart/form-data" action="{% url 'dashboard_media_update' %}">
                                        {% csrf_token %}
                                        <input type="hidden" name="media_key" value="catering_bottom">
                                        <input type="file" name="image" required>
                                        <input type="text" name="alt_text"
                                               placeholder="Alt-Text"
                                               value="{% if img %}{{ img.alt_text }}{% endif %}">
                                        <button type="submit" class="btn btn-primary btn-sm">Speichern</button>
                                    </form>
                                </div>
                            </div>
                            {% endwith %}
                        </div>

                        {# ---------- KONTAKT ---------- #}
                        <div class="media-panel" data-media-panel="media-kontakt">
                            <h3>Kontaktseite</h3>

                            {% with img=site_images.contact_top_bg %}
                            <div class="media-slot">
                                <div class="media-slot-info">
                                    <h4>Kontakt – Oberes Hintergrundbild</h4>
                                    <p>Hintergrund im Streifen „Über uns“.</p>
                                    <p>
                                        Aktuell:
                                        {% if img and img.image %}<a href="{{ img.image.url }}" target="_blank">Bild ansehen</a>
                                        {% else %}<em>Standard-Platzhalter.</em>{% endif %}
                                    </p>
                                </div>
                                <div class="media-slot-form">
                                    <form method="post" enctype="multipart/form-data" action="{% url 'dashboard_media_update' %}">
                                        {% csrf_token %}
                                        <input type="hidden" name="media_key" value="contact_top_bg">
                                        <input type="file" name="image" required>
                                        <input type="text" name="alt_text"
                                               placeholder="Alt-Text"
                                               value="{% if img %}{{ img.alt_text }}{% endif %}">
                                        <button type="submit" class="btn btn-primary btn-sm">Speichern</button>
                                    </form>
                                </div>
                            </div>
                            {% endwith %}

                            {# weitere Slots: contact_philosophie, contact_mission, contact_bottom_bg #}
                        </div>

                        {# ---------- LAYOUT / LOGO ---------- #}
                        <div class="media-panel" data-media-panel="media-layout">
                            <h3>Layout &amp; Logo</h3>

                            {% with img=site_images.global_logo %}
                            <div class="media-slot">
                                <div class="media-slot-info">
                                    <h4>Logo im Header</h4>
                                    <p>Logo oben links in der Navigation.</p>
                                    <p>
                                        Aktuell:
                                        {% if img and img.image %}<a href="{{ img.image.url }}" target="_blank">Bild ansehen</a>
                                        {% else %}<em>Standard-Platzhalter.</em>{% endif %}
                                    </p>
                                </div>
                                <div class="media-slot-form">
                                    <form method="post" enctype="multipart/form-data" action="{% url 'dashboard_media_update' %}">
                                        {% csrf_token %}
                                        <input type="hidden" name="media_key" value="global_logo">
                                        <input type="file" name="image" required>
                                        <input type="text" name="alt_text"
                                               placeholder="Alt-Text"
                                               value="{% if img %}{{ img.alt_text }}{% endif %}">
                                        <button type="submit" class="btn btn-primary btn-sm">Speichern</button>
                                    </form>
                                </div>
                            </div>
                            {% endwith %}
                        </div>

                    </div>
                </div>


                <!-- SEO -->
                <div class="dashboard-panel" data-tab-panel="seo">
                    <h2>SEO</h2>
                    <p>Bearbeite Meta-Titel und Meta-Beschreibungen, z.&nbsp;B. für die Startseite oder spezielle Landingpages.</p>

                    <form method="post" action="">
                        {% csrf_token %}
                        <div class="form-group" style="margin-bottom: 1rem;">
                            <label for="id_meta_title">Meta-Titel</label><br>
                            <input type="text" name="meta_title" id="id_meta_title" class="form-control" placeholder="KBG Europe – Premium Catering in ...">
                        </div>
                        <div class="form-group" style="margin-bottom: 1rem;">
                            <label for="id_meta_description">Meta-Beschreibung</label><br>
                            <textarea name="meta_description" id="id_meta_description" class="form-control" rows="3" placeholder="Kurzer Text, der in der Google-Snippet-Vorschau angezeigt wird."></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Änderungen speichern</button>
                    </form>

                    <div style="margin-top: 2rem;">
                        <h3>Vorschau Google-Snippet (Beispiel)</h3>
                        <div style="background:#fff; border-radius:6px; padding:1rem; box-shadow:0 1px 3px rgba(0,0,0,.08); font-size:.9rem;">
                            <p style="color:#1a0dab; margin-bottom:0;">KBG Europe – Premium Catering in Beispielstadt</p>
                            <p style="color:#006621; margin:0.25rem 0;">www.kbg-europe.de/</p>
                            <p style="color:#4d5156; margin:0;">Hier siehst du eine Vorschau, wie Titel und Meta-Description ungefähr in der Google-Suche aussehen könnten.</p>
                        </div>
                    </div>
                </div>

                <!-- Benutzer-Management (nur Admin) -->
                {% if user.is_superuser %}
                <div class="dashboard-panel" data-tab-panel="benutzer">
                    <h2>Benutzer-Management</h2>
                    <p>Nur für Administratoren sichtbar. Hier kannst du Benutzer einsehen, hinzufügen und löschen.</p>

                    <h3>Benutzerübersicht</h3>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Benutzername</th>
                                <th>E-Mail</th>
                                <th>Rolle</th>
                                <th>Aktionen</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>{{ user.username }}</td>
                                <td>{{ user.email }}</td>
                                <td>
                                    {% if user.is_superuser %}
                                        Admin
                                    {% else %}
                                        Benutzer
                                    {% endif %}
                                </td>
                                <td>
                                    <button type="button" class="btn btn-sm">Bearbeiten</button>
                                    <button type="button" class="btn btn-sm">Löschen</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <h3 style="margin-top: 1.5rem;">Neuen Benutzer anlegen</h3>
                    <p style="font-size:.9rem; color:#555;">
                        Die genaue Funktionalität (Passwort-Handling, Einladungs-Mails usw.) kannst du später in den Views/Forms implementieren.
                    </p>

                    <form method="post" action="">
                        {% csrf_token %}
                        <div class="form-group" style="margin-bottom: .75rem;">
                            <label for="id_new_username">Benutzername</label><br>
                            <input type="text" id="id_new_username" name="new_username" class="form-control" required>
                        </div>
                        <div class="form-group" style="margin-bottom: .75rem;">
                            <label for="id_new_email">E-Mail</label><br>
                            <input type="email" id="id_new_email" name="new_email" class="form-control" required>
                        </div>
                        <div class="form-group" style="margin-bottom: .75rem;">
                            <label for="id_new_password">Passwort</label><br>
                            <input type="password" id="id_new_password" name="new_password" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Benutzer erstellen</button>
                    </form>
                </div>
                {% endif %}

            </div>
        </div>

    </div>
</section>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const tabButtons = document.querySelectorAll("[data-tab-target]");
    const panels = document.querySelectorAll("[data-tab-panel]");

    function activateTab(name) {
        panels.forEach(panel => {
            panel.classList.toggle("dashboard-panel-active", panel.dataset.tabPanel === name);
        });
        tabButtons.forEach(btn => {
            btn.classList.toggle("dashboard-tab-active", btn.dataset.tabTarget === name);
        });
    }

    tabButtons.forEach(btn => {
        btn.addEventListener("click", () => activateTab(btn.dataset.tabTarget));
    });

    if (tabButtons.length > 0) {
        activateTab(tabButtons[0].dataset.tabTarget);
    }

    // NEU: Reply-Form-Toggle
    document.querySelectorAll("[data-toggle-reply]").forEach(btn => {
        btn.addEventListener("click", () => {
            const id = btn.getAttribute("data-toggle-reply");
            const row = document.getElementById(`reply-row-${id}`);
            if (row) {
                row.style.display = row.style.display === "none" || row.style.display === "" ? "table-row" : "none";
            }
        });
    });
});

// Sub-Tabs im Medien-Bereich
const mediaButtons = document.querySelectorAll("[data-media-target]");
const mediaPanels = document.querySelectorAll("[data-media-panel]");

function activateMediaTab(name) {
    mediaPanels.forEach(panel => {
        panel.classList.toggle("media-panel-active", panel.dataset.mediaPanel === name);
    });
    mediaButtons.forEach(btn => {
        btn.classList.toggle("media-subtab-active", btn.dataset.mediaTarget === name);
    });
}

mediaButtons.forEach(btn => {
    btn.addEventListener("click", () => activateMediaTab(btn.dataset.mediaTarget));
});

if (mediaButtons.length > 0) {
    activateMediaTab(mediaButtons[0].dataset.mediaTarget);
}
</script>

<style>
    .dashboard-tabs {
        display: flex;
        border-bottom: 1px solid #ddd;
        margin-bottom: 1rem;
        gap: 0; /* Tabs direkt aneinander */
    }

    .dashboard-tab-btn {
        flex: 1 1 0;
        padding: 0.75rem 1rem;
        border: none;
        border-right: 1px solid #e0e0e0;
        background: #f5f5f5;
        cursor: pointer;
        font-size: 0.95rem;
        text-align: center;
        transition: background 0.15s ease, color 0.15s ease, border-bottom 0.15s ease;
    }

    .dashboard-tab-btn:last-child {
        border-right: none;
    }

    .dashboard-tab-btn.dashboard-tab-active {
        background: #ffffff;
        color: #2f7d32;
        font-weight: 600;
        border-bottom: 3px solid #2f7d32;
    }

    .dashboard-panels {
        padding-top: 1rem;
    }

    .dashboard-panel {
        display: none;
    }

    .dashboard-panel.dashboard-panel-active {
        display: block;
    }

    @media (max-width: 768px) {
        .dashboard-tabs {
            flex-direction: column;
        }
        .dashboard-tab-btn {
            border-right: none;
            border-bottom: 1px solid #e0e0e0;
        }
        .dashboard-tab-btn.dashboard-tab-active {
            border-bottom-width: 3px;
        }
    }

        .media-subtabs {
        display: flex;
        gap: 0.5rem;
        margin: 1rem 0;
        border-bottom: 1px solid #ddd;
        flex-wrap: wrap;
    }

    .media-subtab-btn {
        border: none;
        background: #f3f3f3;
        padding: 0.45rem 0.9rem;
        border-radius: 4px 4px 0 0;
        cursor: pointer;
        font-size: 0.9rem;
    }

    .media-subtab-btn.media-subtab-active {
        background: #ffffff;
        border-bottom: 3px solid #2f7d32;
        font-weight: 600;
        color: #2f7d32;
    }

    .media-panels {
        border-radius: 4px;
        background: #fff;
        padding: 1rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }

    .media-panel { display: none; }
    .media-panel.media-panel-active { display: block; }

    .media-slot {
        display: flex;
        justify-content: space-between;
        gap: 1rem;
        padding: 0.75rem 0;
        border-bottom: 1px solid #eee;
    }

    .media-slot:last-child {
        border-bottom: none;
    }

    .media-slot-info {
        flex: 1;
        font-size: 0.9rem;
    }

    .media-slot-info h4 {
        margin: 0 0 0.25rem;
    }

    .media-slot-form {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
        align-items: flex-start;
    }

    .media-slot-form input[type="file"] {
        font-size: 0.85rem;
    }

    .media-slot-form input[type="text"] {
        width: 100%;
        max-width: 260px;
    }

    @media (max-width: 768px) {
        .media-slot {
            flex-direction: column;
        }
        .media-slot-form {
            width: 100%;
        }
    }
</style>
{% endblock %}
